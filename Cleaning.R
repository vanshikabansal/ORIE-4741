setwd("C:/Users/meaus/OneDrive/Junior/1st Semester/ORIE 4741/hong-kong-horse-racing") #setting the working directory

horse<- read.csv("race-result-horse.csv")
race <- read.csv("race-result-race.csv")

names(horse)
names(race)

n <- nrow(horse)

rr <- horse$horse_number
marks <- c()
for (k in 1:n){
  #if the line is character and the next line is a 1, then that completes a race
  if (k!= n && !is.na(rr[k+1])){
    if (rr[k+1]==1){
      marks <- c(marks,k)
    }
  }
}

marks <- c(marks,n) #includes a marker for the last race
#marks is a vector that includes the index of the last horse in a given race

jk <- unique(horse$jockey) #collects all the unique names of the jockeys/trainers
tr <- unique(horse$trainer)
empty1 <- rep(0,length((jk)))
empty2 <- rep(0,length((tr)))
jockey <- data.frame(jk,empty1) #created a data frame for these
trainer <- data.frame(tr,empty2)
for (i in 1:length(jk)){
  count <- 0 #count helps identify how many races the trainer/jockey is involved in
  for (j in 1:n){
    if (horse$jockey[j] == jk[i]){
      count <- count + 1
      jockey[i,2] <- rr[j]
    }
  }
  jockey[i,2] <- jockey[i,2]/count #the jockey/trainer's metric is the average rank
}

for (i in 1:length(tr)){
  count <- 0
  for (j in 1:n){
    if (horse$trainer[j] == jk[i]){
      count <- count + 1
      trainer[i,2] <- rr[j]
    }
  }
  trainer[i,2] <- trainer[i,2]/count
}